<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenRN Nursing Quiz</title>
    <style>
        :root { --primary: #005f73; --light: #e0fbfc; --error: #ae2012; --success: #0a9396; }
        body { font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: #f4f4f9; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1, h2 { color: var(--primary); }
        button { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
        button:hover { opacity: 0.9; }
        .option-btn { display: block; width: 100%; text-align: left; margin: 5px 0; background: #fff; border: 1px solid #ccc; color: #333; }
        .option-btn.selected { background: var(--light); border-color: var(--primary); font-weight: bold; }
        .hidden { display: none; }
        .review-item { border-bottom: 1px solid #eee; padding: 10px 0; }
        .correct-text { color: var(--success); font-weight: bold; }
        .wrong-text { color: var(--error); font-weight: bold; }
        #loading-msg { color: #666; font-style: italic; }
    </style>
</head>
<body>

    <div id="start-screen" class="card">
        <h1>Nursing Quiz (OER)</h1>
        <p id="loading-msg">Loading question bank...</p>
        <div id="selection-area" class="hidden">
            <p>Select a subject to begin:</p>
            <select id="subject-select" style="padding: 10px; width: 100%; margin-bottom: 15px;">
                <option value="All">All Subjects</option>
                </select>
            <button onclick="startQuiz()">Start Quiz</button>
        </div>
    </div>

    <div id="quiz-screen" class="card hidden">
        <h2 id="question-header">Question 1/10</h2>
        <p id="question-text">Loading...</p>
        <div id="options-container"></div>
        <button id="next-btn" onclick="nextQuestion()" class="hidden">Next Question</button>
    </div>

    <div id="result-screen" class="card hidden">
        <h2>Quiz Complete!</h2>
        <p>Your Score: <span id="score-display" style="font-weight:bold; font-size:1.2em;"></span></p>
        <div id="review-container"></div>
        <button onclick="location.reload()">Take Another Quiz</button>
    </div>

    <script>
        let questionBank = [];
        let currentQuestions = [];
        let currentIndex = 0;
        let score = 0;

        // 1. FETCH DATA ON LOAD
        window.onload = async function() {
            try {
                const response = await fetch('questions.json');
                if (!response.ok) throw new Error("Could not find questions.json");
                
                questionBank = await response.json();
                
                // Populate Dropdown
                const subjects = [...new Set(questionBank.map(q => q.subject))];
                const select = document.getElementById('subject-select');
                subjects.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.innerText = sub;
                    select.appendChild(opt);
                });

                document.getElementById('loading-msg').classList.add('hidden');
                document.getElementById('selection-area').classList.remove('hidden');

            } catch (error) {
                document.getElementById('loading-msg').innerText = "Error loading questions. Make sure questions.json exists!";
                console.error(error);
            }
        };

        function startQuiz() {
            const subject = document.getElementById('subject-select').value;
            
            let filtered = subject === "All" 
                ? questionBank 
                : questionBank.filter(q => q.subject === subject);

            if(filtered.length === 0) { alert("No questions found for this subject!"); return; }

            // Shuffle and pick 10
            currentQuestions = filtered.sort(() => 0.5 - Math.random()).slice(0, 10);
            
            currentIndex = 0;
            score = 0;
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            const q = currentQuestions[currentIndex];
            document.getElementById('question-header').innerText = `Question ${currentIndex + 1}/${currentQuestions.length}`;
            document.getElementById('question-text').innerText = q.question;
            
            const container = document.getElementById('options-container');
            container.innerHTML = ''; 
            document.getElementById('next-btn').classList.add('hidden');

            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => selectOption(btn, opt);
                container.appendChild(btn);
            });
        }

        function selectOption(btn, selectedText) {
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            currentQuestions[currentIndex].userSelected = selectedText;
            document.getElementById('next-btn').classList.remove('hidden');
        }

        function nextQuestion() {
            const q = currentQuestions[currentIndex];
            if (q.userSelected === q.answer) {
                score++;
                q.isCorrect = true;
            } else {
                q.isCorrect = false;
            }

            currentIndex++;
            if (currentIndex < currentQuestions.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('score-display').innerText = `${score} / ${currentQuestions.length}`;
            
            const container = document.getElementById('review-container');
            container.innerHTML = '<h3>Review Wrong Answers:</h3>';

            const wrongAnswers = currentQuestions.filter(q => !q.isCorrect);
            
            if (wrongAnswers.length === 0) {
                container.innerHTML += "<p>Perfect score! Great job.</p>";
            } else {
                wrongAnswers.forEach(q => {
                    container.innerHTML += `
                        <div class="review-item">
                            <p><strong>Q:</strong> ${q.question}</p>
                            <p class="wrong-text">You chose: ${q.userSelected}</p>
                            <p class="correct-text">Correct: ${q.answer}</p>
                            <p><em>Rationale: ${q.rationale}</em></p>
                        </div>
                    `;
                });
            }
        }
    </script>
</body>
</html>
